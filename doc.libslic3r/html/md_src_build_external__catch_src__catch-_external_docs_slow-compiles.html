<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libslic3r: slow-compiles</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libslic3r
   </div>
   <div id="projectbrief">Library for generating gcode from 3d models</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">slow-compiles </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="top"></a> </p><h1>Why do my tests take so long to compile?</h1>
<p><b>Contents</b><br  />
 <a href="#short-answer">Short answer</a><br  />
 <a href="#long-answer">Long answer</a><br  />
 <a href="#practical-example">Practical example</a><br  />
 <a href="#other-possible-solutions">Other possible solutions</a><br  />
</p>
<p>Several people have reported that test code written with <a class="el" href="namespace_catch.html">Catch</a> takes much longer to compile than they would expect. Why is that?</p>
<p><a class="el" href="namespace_catch.html">Catch</a> is implemented entirely in headers. There is a little overhead due to this - but not as much as you might think - and you can minimise it simply by organising your test code as follows:</p>
<h2>Short answer</h2>
<p>Exactly one source file must <code>#define</code> either <code>CATCH_CONFIG_MAIN</code> or <code>CATCH_CONFIG_RUNNER</code> before <code>#include</code>-ing <a class="el" href="namespace_catch.html">Catch</a>. In this file <em>do not write any test cases</em>! In most cases that means this file will just contain two lines (the <code>#define</code> and the <code>#include</code>).</p>
<h2>Long answer</h2>
<p>Usually C++ code is split between a header file, containing declarations and prototypes, and an implementation file (.cpp) containing the definition, or implementation, code. Each implementation file, along with all the headers that it includes (and which those headers include, etc), is expanded into a single entity called a translation unit - which is then passed to the compiler and compiled down to an object file.</p>
<p>But functions and methods can also be written inline in header files. The downside to this is that these definitions will then be compiled in <em>every</em> translation unit that includes the header.</p>
<p>Because <a class="el" href="namespace_catch.html">Catch</a> is implemented <em>entirely</em> in headers you might think that the whole of <a class="el" href="namespace_catch.html">Catch</a> must be compiled into every translation unit that uses it! Actually it's not quite as bad as that. <a class="el" href="namespace_catch.html">Catch</a> mitigates this situation by effectively maintaining the traditional separation between the implementation code and declarations. Internally the implementation code is protected by <code>#ifdef</code>s and is conditionally compiled into only one translation unit. This translation unit is that one that <code>#define</code>s <code>CATCH_CONFIG_MAIN</code> or <code>CATCH_CONFIG_RUNNER</code>. Let's call this the main source file.</p>
<p>As a result the main source file <em>does</em> compile the whole of <a class="el" href="namespace_catch.html">Catch</a> every time! So it makes sense to dedicate this file to <em>only</em> <code>#define</code>-ing the identifier and <code>#include</code>-ing <a class="el" href="namespace_catch.html">Catch</a> (and implementing the runner code, if you're doing that). Keep all your test cases in other files. This way you won't pay the recompilation cost for the whole of <a class="el" href="namespace_catch.html">Catch</a></p>
<h2>Practical example</h2>
<p>Assume you have the <code>Factorial</code> function from the <a href="tutorial.md#top">tutorial</a> in <code>factorial.cpp</code> (with forward declaration in <code>factorial.h</code>) and want to test it and keep the compile times down when adding new tests. Then you should have 2 files, <code>tests-main.cpp</code> and <code>tests-factorial.cpp</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// tests-main.cpp</span></div>
<div class="line"><span class="preprocessor">#define CATCH_CONFIG_MAIN</span></div>
<div class="line"><span class="preprocessor">#include &quot;catch.hpp&quot;</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// tests-factorial.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;catch.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;factorial.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="include_2catch_8hpp.html#abd6e2aec703006b3da62cf7860c9808f">TEST_CASE</a>( <span class="stringliteral">&quot;Factorials are computed&quot;</span>, <span class="stringliteral">&quot;[factorial]&quot;</span> ) {</div>
<div class="line">    <a class="code" href="include_2catch_8hpp.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>( <a class="code" href="_misc_tests_8cpp.html#a2660e74adb084fa0f68d029f3bd5f1f5">Factorial</a>(1) == 1 );</div>
<div class="line">    <a class="code" href="include_2catch_8hpp.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>( <a class="code" href="_misc_tests_8cpp.html#a2660e74adb084fa0f68d029f3bd5f1f5">Factorial</a>(2) == 2 );</div>
<div class="line">    <a class="code" href="include_2catch_8hpp.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>( <a class="code" href="_misc_tests_8cpp.html#a2660e74adb084fa0f68d029f3bd5f1f5">Factorial</a>(3) == 6 );</div>
<div class="line">    <a class="code" href="include_2catch_8hpp.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>( <a class="code" href="_misc_tests_8cpp.html#a2660e74adb084fa0f68d029f3bd5f1f5">Factorial</a>(10) == 3628800 );</div>
<div class="line">}</div>
</div><!-- fragment --><p>After compiling <code>tests-main.cpp</code> once, it is enough to link it with separately compiled <code>tests-factorial.cpp</code>. This means that adding more tests to <code>tests-factorial.cpp</code>, will not result in recompiling <a class="el" href="namespace_catch.html">Catch</a>'s main and the resulting compilation times will decrease substantially.</p>
<div class="fragment"><div class="line">$ g++ tests-main.cpp -c</div>
<div class="line">$ g++ tests-main.o tests-factorial.cpp -o tests &amp;&amp; ./tests -r compact</div>
<div class="line">Passed 1 test case with 4 assertions.</div>
</div><!-- fragment --><p>Now, the next time we change the file <code>tests-factorial.cpp</code> (say we add <code>REQUIRE( Factorial(0) == 1)</code>), it is enough to recompile the tests instead of recompiling main as well:</p>
<div class="fragment"><div class="line">$ g++ tests-main.o tests-factorial.cpp -o tests &amp;&amp; ./tests -r compact</div>
<div class="line">tests-factorial.cpp:11: failed: Factorial(0) == 1 for: 0 == 1</div>
<div class="line">Failed 1 test case, failed 1 assertion.</div>
</div><!-- fragment --><h2>Other possible solutions</h2>
<p>You can also opt to sacrifice some features in order to speed-up <a class="el" href="namespace_catch.html">Catch</a>'s compilation times. For details see the <a href="configuration.md#other-toggles">documentation on Catch's compile-time configuration</a>.</p>
<hr  />
<p><a href="Readme.md#top">Home</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="ainclude_2catch_8hpp_html_abd6e2aec703006b3da62cf7860c9808f"><div class="ttname"><a href="include_2catch_8hpp.html#abd6e2aec703006b3da62cf7860c9808f">TEST_CASE</a></div><div class="ttdeci">#define TEST_CASE(...)</div><div class="ttdef"><b>Definition:</b> catch.hpp:11844</div></div>
<div class="ttc" id="a_misc_tests_8cpp_html_a2660e74adb084fa0f68d029f3bd5f1f5"><div class="ttname"><a href="_misc_tests_8cpp.html#a2660e74adb084fa0f68d029f3bd5f1f5">Factorial</a></div><div class="ttdeci">unsigned int Factorial(unsigned int number)</div><div class="ttdef"><b>Definition:</b> MiscTests.cpp:174</div></div>
<div class="ttc" id="ainclude_2catch_8hpp_html_ad57835ba8f1bb419a865ada6bd011a85"><div class="ttname"><a href="include_2catch_8hpp.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a></div><div class="ttdeci">#define REQUIRE(...)</div><div class="ttdef"><b>Definition:</b> catch.hpp:11809</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
